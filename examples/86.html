<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PPC.js 32-bit CPU tests</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { padding: 2rem; font-family: "Segoe UI", Tahoma, sans-serif; }
    pre { background: #f8f9fa; padding: 1rem; border-radius: .5rem; white-space: pre-wrap; }
    textarea { width: 100%; height: 150px; font-family: monospace; margin-bottom: 1rem; }
  </style>
</head>
<body>

<div class="container">
  <h1>PPC.js 32-bit CPU tests</h1>
  
  <div class="mb-3">
    <label for="code32" class="form-label">Enter x86 instructions (hex, one per line)</label>
    <textarea id="code32">00000000
C3</textarea>
    <button id="run32" class="btn btn-primary">Run CPU</button>
  </div>

  <h3>Registers</h3>
  <pre id="regs32"></pre>

  <h3>Execution Log</h3>
  <pre id="log32"></pre>
</div>

<script src="https://izhank216.github.io/PPC.js/dist/ppc.min.js"></script>
<script>
const regsEl = document.getElementById("regs32");
const logEl = document.getElementById("log32");
const codeEl = document.getElementById("code32");
const runBtn = document.getElementById("run32");

function updateRegisters32() {
  let html = "";
  Object.entries(cpu32.gpr).forEach(([name,val])=> html += `${name}: ${val.toNumber()}  `);
  html += `\nPC: ${cpu32.pc.toNumber()}  EFLAGS: ${cpu32.eflags}`;
  regsEl.textContent = html;
}

function runCPU32() {
  logEl.textContent = "";
  const memory = new PPC.Memory(1024*1024);
  window.cpu32 = new PPC.CPUx86();
  cpu32.memory = memory;
  cpu32.pc = new PPC.CPUx86.Int32(0x100);

  // load user instructions
  const lines = codeEl.value.split("\n").map(l => l.trim()).filter(l=>l);
  lines.forEach((line,i)=>{
    const addr = 0x100 + i*4;
    memory.write32(addr, parseInt(line,16));
  });

  let cycles32 = 0;
  function step() {
    if(cycles32 < 20){
      cpu32.step();
      logEl.textContent += `Cycle ${cycles32+1}: PC=${cpu32.pc.toNumber().toString(16)}\n`;
      updateRegisters32();
      cycles32++;
      requestAnimationFrame(step);
    } else {
      logEl.textContent += "PPC 32-bit CPU test finished.\n";
    }
  }
  step();
}

runBtn.onclick = runCPU32;
runCPU32();
</script>

</body>
</html>
