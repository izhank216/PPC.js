<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PPC.js 64-bit CPU tests</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { 
      padding: 2rem; 
      font-family: "Segoe UI", Tahoma, sans-serif; 
      background-color: #1e1e1e; 
      color: #e0e0e0; 
    }
    pre { 
      background: #2d2d2d; 
      padding: 1rem; 
      border-radius: .5rem; 
      white-space: pre-wrap; 
      color: #e0e0e0;
      overflow-x: auto;
    }
    textarea { 
      width: 100%; 
      height: 150px; 
      font-family: monospace; 
      margin-bottom: 1rem; 
      background: #2d2d2d; 
      color: #e0e0e0; 
      border: 1px solid #555; 
      border-radius: .25rem;
    }
    button { margin-bottom: 1rem; }
  </style>
</head>
<body>

<div class="container">
  <h1>PPC.js 64-bit CPU tests</h1>
  
  <div class="mb-3">
    <label for="code64" class="form-label">Enter PPC 64-bit instructions (hex, one per line)</label>
    <textarea id="code64">7C000214
4E800020</textarea>
    <button id="run64" class="btn btn-primary">Run CPU</button>
  </div>

  <h3>Registers</h3>
  <pre id="regs64"></pre>

  <h3>Execution Log</h3>
  <pre id="log64"></pre>
</div>

<script src="https://izhank216.github.io/PPC.js/dist/ppc.min.js"></script>
<script>
const regsEl = document.getElementById("regs64");
const logEl = document.getElementById("log64");
const codeEl = document.getElementById("code64");
const runBtn = document.getElementById("run64");

function updateRegisters() {
  let html = "";
  cpu.gpr.forEach((r,i)=>{
    html += `Register: R${i} = ${r.toNumber()}\n`;
  });
  html += `PC: ${cpu.pc.toNumber()}  LR: ${cpu.lr.toNumber()}  CR: ${cpu.cr}`;
  regsEl.textContent = html;
}

function runCPU() {
  logEl.textContent = "";
  regsEl.textContent = "";
  
  const memory = new PPC.Memory(1024*1024);
  window.cpu = new PPC.CPU();
  cpu.memory = memory;
  cpu.pc = new PPC.CPU.Int64(0x100);

  // load user instructions
  const lines = codeEl.value.split("\n").map(l => l.trim()).filter(l=>l);
  lines.forEach((line,i)=>{
    const addr = 0x100 + i*4;
    memory.write32(addr, parseInt(line,16));
  });

  let cycles = 0;
  function step() {
    if(cycles < 20){
      cpu.step();
      logEl.textContent += `Cycle ${cycles+1}: PC=${cpu.pc.toNumber().toString(16)}\n`;
      updateRegisters();
      cycles++;
      requestAnimationFrame(step);
    } else {
      logEl.textContent += "PPC 64-bit CPU test finished.\n";
    }
  }
  step();
}

runBtn.onclick = runCPU;
</script>

</body>
</html>
